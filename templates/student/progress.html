{% extends "base_student.html" %}

{% block title %}Ti·∫øn ƒê·ªô H·ªçc T·∫≠p - Nh√≥m 1{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/progress.css') }}">
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="mb-4">
        <h2 class="fw-bold text-primary">Ti·∫øn ƒë·ªô h·ªçc t·∫≠p üöÄ</h2>
        <p class="text-muted small">AI ph√¢n t√≠ch d·ª±a tr√™n d·ªØ li·ªáu l√†m b√†i c·ªßa b·∫°n.</p>
    </div>

    <div class="row g-3">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0 rounded-4 p-3 h-100">
                <h6 class="fw-bold"><i class="fa-solid fa-chart-line me-2 text-primary"></i>Bi·ªÉu ƒë·ªì ƒëi·ªÉm s·ªë</h6>
                <div class="chart-container" style="position: relative; height:300px;">
                    <canvas id="scoreChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="d-flex flex-column gap-2 h-100">
                <div class="p-3 bg-primary bg-opacity-10 border-start border-primary border-4 rounded-3">
                    <small class="text-primary fw-bold">PHONG ƒê·ªò</small>
                    <p class="mb-0 small text-dark text-break">{{ report.trend }}</p>
                </div>
                <div class="p-3 bg-warning bg-opacity-10 border-start border-warning border-4 rounded-3">
                    <small class="text-warning fw-bold">L·ªñ H·ªîNG</small>
                    <p class="mb-0 small text-dark text-break">{{ report.gaps }}</p>
                </div>
                <div class="p-3 bg-success bg-opacity-10 border-start border-success border-4 rounded-3">
                    <small class="text-success fw-bold">T∆Ø DUY</small>
                    <p class="mb-0 small text-dark text-break">{{ report.cognitive }}</p>
                </div>
            </div>
        </div>

        <div class="col-12">
            <div class="card border-0 bg-primary text-white p-3 rounded-4 shadow-sm">
                <div class="d-flex align-items-center">
                    <div class="fs-1 me-3">üéØ</div>
                        <div>
                            <h6 class="fw-bold mb-1">G·ª£i √Ω h√†nh ƒë·ªông ti·∫øp theo:</h6>
                            <p class="mb-0 small opacity-75">
                            {% if "ch∆∞a t·∫°o th√†nh l·ªó h·ªïng" in report.gaps or "Tuy·ªát v·ªùi" in report.gaps %}
                                Ch√∫c m·ª´ng! B·∫°n ƒëang gi·ªØ phong ƒë·ªô r·∫•t t·ªët. H√£y th·ª≠ th√°ch b·∫£n th√¢n v·ªõi c√°c ƒë·ªÅ thi v·∫≠n d·ª•ng cao nh√©!
                            {% else %}
                                AI g·ª£i √Ω b·∫°n n√™n d√†nh th√™m 15 ph√∫t √¥n t·∫≠p l·∫°i ki·∫øn th·ª©c v·ªÅ: <b>{{ report.gaps }}</b>.
                            {% endif %}
                            </p>
                        </div>
                </div>
            </div>
        </div>

        <div class="col-12">
            <div class="card shadow-sm border-0 rounded-4 p-3">
                <h6 class="fw-bold mb-3">üìã L·ªãch s·ª≠ 10 b√†i g·∫ßn nh·∫•t</h6>
                <div class="table-responsive">
                    <table class="table table-sm table-hover mb-0">
                        <thead class="table-light text-secondary">
                            <tr>
                                <th>Ng√†y l√†m b√†i</th>
                                <th>ƒêi·ªÉm s·ªë</th>
                                <th>ƒê√°nh gi√°</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for exam in exams %}
                            <tr>
                                <td class="small text-muted">{{ exam.CreatedAt[:10] }}</td>
                                <td class="fw-bold text-primary">{{ exam.TotalScore }}/10</td>
                                <td>
                                    {% if exam.TotalScore >= 8 %}
                                        <span class="badge bg-success-subtle text-success border border-success-subtle">T·ªët</span>
                                    {% elif exam.TotalScore >= 5 %}
                                        <span class="badge bg-primary-subtle text-primary border border-primary-subtle">ƒê·∫°t</span>
                                    {% else %}
                                        <span class="badge bg-danger-subtle text-danger border border-danger-subtle">C·∫ßn c·ªë g·∫Øng</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 p-3 bg-white rounded-3 text-center border shadow-sm">
        <p class="text-muted mb-0 small">
            <i class="fa-solid fa-robot me-1"></i> <b>C∆° ch·∫ø AI:</b> H·ªá th·ªëng k·∫øt h·ª£p ph√¢n t√≠ch SQL L·ªõp 2 v√† s·ª©c m·∫°nh c·ªßa Google Gemini ƒë·ªÉ ƒë∆∞a ra l·ªùi khuy√™n c√° nh√¢n h√≥a.
        </p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // L·∫•y danh s√°ch ƒëi·ªÉm
    const SERVER_SCORE_LIST = {{ score_list | tojson }};
    
    // L·∫•y danh s√°ch ng√†y l√†m b√†i (l·∫•y t·ª´ bi·∫øn exams ƒë√£ c√≥ s·∫µn trong route)
    // Ch√∫ng ta c≈©ng ƒë·∫£o ng∆∞·ª£c [::-1] gi·ªëng score_list ƒë·ªÉ kh·ªõp th·ª© t·ª±
    const SERVER_DATE_LIST = [
        {% for exam in exams|reverse %}
            "{{ exam.CreatedAt[:10] }}",
        {% endfor %}
    ];
</script>
<script src="{{ url_for('static', filename='js/progress_chart.js') }}"></script>
{% endblock %}