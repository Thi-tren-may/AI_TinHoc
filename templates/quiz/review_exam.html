{% extends "base_student.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/quiz_s2.css') }}">

<div class="container pb-5" style="margin-top: 100px;">
    
    <!-- Header: Kết quả tổng quan -->
    <div class="card border-0 shadow-sm rounded-4 mb-4 bg-white">
        <div class="card-body p-4 d-flex justify-content-between align-items-center">
            <div>
                <h4 class="fw-bold text-primary mb-1">
                    <i class="fas fa-file-signature me-2"></i>Chi tiết bài làm
                </h4>
                <a href="{{ url_for('test.history') }}" class="text-muted text-decoration-none small">
                    <i class="fas fa-arrow-left me-1"></i> Quay lại lịch sử
                </a>
            </div>
            <div class="text-end">
                <div class="fs-2 fw-bold text-{{ 'success' if exam.TotalScore >= 5 else 'danger' }}">
                    {{ exam.TotalScore }}<span class="fs-5 text-muted">/10</span>
                </div>
                <span class="badge bg-light text-dark border">Điểm số</span>
            </div>
        </div>
    </div>

    <!-- Danh sách câu hỏi -->
    <div class="row">
        <div class="col-md-10 mx-auto">
            {% for q in questions %}
            <div class="card mb-3 border-0 shadow-sm rounded-4 position-relative overflow-hidden">
                <!-- Vạch màu bên trái: Xanh nếu đúng, Đỏ nếu sai -->
                <div class="position-absolute top-0 start-0 bottom-0 bg-{{ 'success' if q.IsRight else 'danger' }}" style="width: 5px;"></div>
                
                <div class="card-body p-4 ps-4">
                    <!-- Nội dung câu hỏi -->
                    <h6 class="fw-bold text-dark mb-3">
                        <span class="text-{{ 'success' if q.IsRight else 'danger' }}">Câu {{ loop.index }}:</span> 
                        {{ q.Content }}
                    </h6>

                    <!-- Các đáp án -->
                    <div class="row g-2">
                        {% for key, val in q.Options.items() %}
                        <div class="col-md-6">
                            <!-- Logic tô màu đáp án -->
                            {% set is_selected = (key == q.Selected) %}
                            {% set is_correct = (key == q.Correct) %}
                            
                            <div class="p-3 border rounded-3 d-flex align-items-center 
                                {% if is_selected and is_correct %} bg-success-subtle border-success text-success fw-bold
                                {% elif is_selected and not is_correct %} bg-danger-subtle border-danger text-danger
                                {% elif is_correct %} bg-success-subtle border-success text-success fw-bold
                                {% else %} bg-light {% endif %}">
                                
                                <!-- Icon trạng thái -->
                                <div class="me-3" style="width: 25px;">
                                    {% if is_selected and is_correct %}<i class="fas fa-check-circle"></i>
                                    {% elif is_selected and not is_correct %}<i class="fas fa-times-circle"></i>
                                    {% elif is_correct %}<i class="fas fa-check"></i>
                                    {% else %}<span class="fw-bold text-muted">{{ key }}</span>{% endif %}
                                </div>
                                
                                <div>{{ val }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Giải thích (Nếu sai) -->
                    {% if not q.IsRight %}
                    <div class="mt-3 p-2 px-3 bg-light rounded text-muted small border-start border-4 border-warning">
                        <i class="fas fa-exclamation-triangle text-warning me-1"></i> 
                        Bạn chọn <b>{{ q.Selected }}</b> là sai. Đáp án đúng là <b>{{ q.Correct }}</b>.
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}