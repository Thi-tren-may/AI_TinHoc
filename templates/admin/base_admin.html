{% extends "base.html" %}

{% block content %}
<style>
    /* --- 1. LAYOUT & SIDEBAR --- */
    .admin-container {
        display: flex;
        width: 100%;
        min-height: calc(100vh - 56px);
        overflow-x: hidden;
        transition: all 0.3s ease;
    }

    .sidebar {
        min-width: 260px;
        max-width: 260px;
        background: #ffffff;
        border-right: 1px solid #e9ecef;
        padding: 20px 15px;
        box-shadow: 2px 0 10px rgba(0,0,0,0.03);
        transition: all 0.3s ease;
        margin-left: 0; 
        position: relative;
        z-index: 100;
    }

    .sidebar.toggled {
        margin-left: -260px;
    }

    .sidebar-heading {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        color: #adb5bd;
        font-weight: 800;
        margin-bottom: 15px;
        margin-top: 10px;
        padding-left: 10px;
    }

    /* --- 2. MENU LINKS --- */
    .sidebar-link {
        display: flex;
        align-items: center;
        padding: 12px 18px;
        color: #6c757d;
        text-decoration: none;
        border-radius: 50px;
        transition: all 0.2s ease;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 0.95rem;
    }

    .sidebar-link:hover {
        background-color: #f1f3f5;
        color: #0d6efd;
        transform: translateX(5px);
    }

    .sidebar-link.active {
        background: linear-gradient(45deg, #0d6efd, #0a58ca);
        color: white !important;
        box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
    }
    
    .sidebar-link i {
        width: 25px;
        font-size: 1.1rem;
        margin-right: 10px;
        transition: transform 0.3s;
    }
    
    .sidebar-link.active i {
        transform: scale(1.1); 
    }

    /* --- 3. CONTENT AREA (QUAN TRỌNG: position relative) --- */
    .content-area {
        flex: 1;
        padding: 30px;
        background-color: #f8f9fc;
        display: flex;
        flex-direction: column;
        width: 100%;
        position: relative; /* Để làm mốc cho nút Toggle bay lên góc */
    }

    /* --- 4. NÚT TOGGLE MENU (TỐI GIẢN) --- */
    .btn-toggle-menu {
        background: transparent; /* Nền trong suốt */
        border: none;
        color: #adb5bd;     /* Màu xám nhạt tinh tế */
        font-size: 1.4rem;  /* Kích thước vừa phải */
        cursor: pointer;
        padding: 5px;
        transition: all 0.2s;
        margin-right: 15px;
    }
    
    .btn-toggle-menu:hover {
        color: #0d6efd;     /* Di chuột vào thì hiện màu xanh */
        transform: scale(1.1);
    }

    .admin-footer {
        margin-top: auto;
        padding-top: 20px;
        border-top: 1px solid #e3e6f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #6c757d;
        font-size: 0.85rem;
    }

    /* --- 5. NÚT SCROLL TO TOP --- */
    .btn-scroll-top {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 45px;
        height: 45px;
        background-color: #0d6efd;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        box-shadow: 0 5px 15px rgba(13, 110, 253, 0.3);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 9999;
        font-size: 1.2rem;
        border: 2px solid white;
    }

    .btn-scroll-top:hover {
        background-color: #0a58ca;
        color: white;
        transform: translateY(-5px);
    }

    .btn-scroll-top.show {
        opacity: 1;
        visibility: visible;
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .sidebar {
            margin-left: -260px;
            position: fixed;
            height: 100%;
        }
        .sidebar.toggled {
            margin-left: 0;
            box-shadow: 10px 0 20px rgba(0,0,0,0.2);
        }
        .overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 99;
        }
        .overlay.active { display: block; }
    }

    /* --- 6. ADMIN TOPBAR --- */
    .admin-topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #fff;
        padding: 10px 30px;
        margin: -30px -30px 30px -30px; /* Negative margin to cover padding of content-area */
        border-bottom: 1px solid #e3e6f0;
        box-shadow: 0 .15rem 1.75rem 0 rgba(58,59,69,.15);
    }
    
    .user-admin-card {
        transition: all 0.3s ease;
    }
</style>

<div class="container-fluid p-0">
    <div class="admin-container">
        
        <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

        <div class="sidebar" id="sidebar"> 
            <div class="sidebar-heading">Quản lý chung</div>
            
            <a href="{{ url_for('admin.dashboard') }}" 
               class="sidebar-link {{ 'active' if request.endpoint == 'admin.dashboard' }}">
                <i class="fas fa-chart-pie"></i> Tổng quan
            </a>
            
            <a href="{{ url_for('admin.manage_topics') }}" 
               class="sidebar-link {{ 'active' if 'topic' in request.endpoint }}">
                <i class="fas fa-layer-group"></i> Quản lý chủ đề
            </a>

            <a href="{{ url_for('admin.manage_questions') }}" 
               class="sidebar-link {{ 'active' if 'question' in request.endpoint }}">
                <i class="fas fa-database"></i> Ngân hàng câu hỏi
            </a>
            
            <a href="{{ url_for('admin.manage_students') }}" 
               class="sidebar-link {{ 'active' if 'student' in request.endpoint }}">
                <i class="fas fa-users"></i> Quản lý học sinh
            </a>
        </div>

        <div class="content-area">
            
            <!-- TOPBAR -->
            <div class="admin-topbar">
                <button class="btn-toggle-menu" onclick="toggleMenu()" title="Ẩn/Hiện Menu">
                    <i class="fas fa-bars"></i>
                </button>

                <!-- ADMIN PROFILE -->
                <div class="d-flex align-items-center user-admin-card">
                    <div class="me-3 text-end lh-1 d-none d-sm-block">
                        <small class="d-block text-muted text-uppercase" style="font-size: 0.65rem; font-weight: 700; letter-spacing: 0.5px;">Quản trị viên</small>
                        <span class="fw-bold text-dark" style="font-size: 0.9rem;">
                            {{ current_user.Username if current_user and current_user.is_authenticated else 'Admin' }}
                        </span>
                    </div>
                    <div class="dropdown">
                        <a class="btn btn-light rounded-circle p-0 shadow-sm dropdown-toggle" 
                           href="#" 
                           role="button" 
                           id="adminDropdown"
                           data-bs-toggle="dropdown"
                           aria-expanded="false"
                           style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #0d6efd 0%, #00d4ff 100%); color: white; border: none;">
                            <i class="fas fa-user-shield"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg mt-2" aria-labelledby="adminDropdown" style="border-radius: 12px; overflow: hidden;">
                            <li><a class="dropdown-item py-2" href="{{ url_for('auth.profile') }}"><i class="fas fa-user-circle me-2 text-primary"></i> Hồ sơ cá nhân</a></li>
                            <li><hr class="dropdown-divider my-1"></li>
                            <li><a class="dropdown-item py-2 text-danger fw-bold" href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt me-2"></i> Đăng xuất</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            {% block admin_content %}{% endblock %}
            
            <footer class="admin-footer">
                <div>
                    <span>Thiết kế bởi: Nhóm 1 - Hệ thống AI TIN HỌC - Hỗ trợ luyện thi THPT và đánh giá năng lực.</span>
                </div>
            </footer>
        </div>
    </div>
</div>

<a href="#" class="btn-scroll-top" id="scrollTopBtn">
    <i class="fas fa-arrow-up"></i>
</a>

<script>
    function toggleMenu() {
        document.getElementById("sidebar").classList.toggle("toggled");
        document.getElementById("overlay").classList.toggle("active");
    }

    const scrollTopBtn = document.getElementById("scrollTopBtn");
    window.onscroll = function() {
        if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
            scrollTopBtn.classList.add("show");
        } else {
            scrollTopBtn.classList.remove("show");
        }
    };
    scrollTopBtn.addEventListener("click", function(e) {
        e.preventDefault();
        window.scrollTo({
            top: 0,
            behavior: "smooth"
        });
    });
</script>
{% endblock %}