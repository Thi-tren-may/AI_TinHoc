{% extends "admin/base_admin.html" %}

{% block admin_content %}
<div class="container-fluid animate-fade-in px-4">
    <div class="card card-pro border-0 shadow-lg mt-4">
        
        <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center py-3">
            <h5 class="mb-0 fw-bold text-uppercase fs-6">
                <i class="fas fa-user-edit me-2"></i> S·ª¨A TH√îNG TIN H·ªåC SINH #{{ student['Id'] }}
            </h5>
            <a href="{{ url_for('admin.manage_students') }}" class="btn btn-danger fw-bold rounded-pill px-3 shadow-sm">
                <i class="fas fa-arrow-left me-2"></i> Quay l·∫°i
            </a>
        </div>
        
        <div class="card-body p-4">
            <form method="post" id="editForm">
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <label class="form-label fw-bold text-primary">
                            <i class="fas fa-user-circle me-1"></i> T√äN ƒêƒÇNG NH·∫¨P
                        </label>
                        <input type="text" name="username" id="usernameInput" class="form-control bg-light py-2" value="{{ student['Username'] }}" required>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold text-primary">
                            <i class="fas fa-key me-1"></i> M·∫¨T KH·∫®U M·ªöI
                        </label>
                        
                        <div class="input-group">
                            <input type="password" name="password" id="passwordInput" class="form-control bg-light py-2 border-end-0" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi pass">
                            <button class="btn btn-light border border-start-0 text-muted" type="button" onclick="togglePassword()" style="background-color: #f8f9fa;">
                                <i class="fas fa-eye" id="toggleIcon"></i>
                            </button>
                        </div>
                        <div class="form-text text-danger fst-italic small mt-1">
                            <i class="fas fa-info-circle"></i> Ch·ªâ nh·∫≠p v√†o ƒë√¢y n·∫øu mu·ªën ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u.
                        </div>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-4">
                        <label class="form-label fw-bold text-primary">
                            <i class="fas fa-graduation-cap me-1"></i> KH·ªêI L·ªöP
                        </label>
                        <select name="grade" id="gradeSelect" class="form-select bg-light py-2 fw-bold text-dark">
                            <option value="10" {% if student['Grade'] == 10 %}selected{% endif %}>üü¶ Kh·ªëi 10</option>
                            <option value="11" {% if student['Grade'] == 11 %}selected{% endif %}>üü® Kh·ªëi 11</option>
                            <option value="12" {% if student['Grade'] == 12 %}selected{% endif %}>üü© Kh·ªëi 12</option>
                        </select>
                    </div>
                </div>

                <hr class="my-4 text-muted opacity-25">

                <div class="d-flex justify-content-end align-items-center">
                    <span id="changeMsg" class="text-muted fst-italic me-3 small" style="display:none;">
                        <i class="fas fa-pen-nib"></i> B·∫°n ƒë√£ thay ƒë·ªïi th√¥ng tin
                    </span>
                    <button type="submit" id="saveBtn" class="btn btn-warning text-dark fw-bold py-2 px-5 shadow opacity-50" disabled>
                        <i class="fas fa-save me-2"></i> L∆ØU THAY ƒê·ªîI
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    /* CSS cho Input group ƒë·∫πp h∆°n */
    .form-control:focus {
        background-color: #fff !important;
        border-color: #ffc107; /* Vi·ªÅn v√†ng khi active */
        box-shadow: none; 
        z-index: 1;
    }
    .input-group:focus-within {
        box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.25);
        border-radius: 0.375rem;
    }
    .input-group:focus-within .form-control, 
    .input-group:focus-within .btn {
        border-color: #ffc107;
    }
</style>

<script>
    // 1. H√†m b·∫≠t/t·∫Øt xem m·∫≠t kh·∫©u
    function togglePassword() {
        const passwordInput = document.getElementById('passwordInput');
        const icon = document.getElementById('toggleIcon');
        
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            passwordInput.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }

    // 2. H√†m ki·ªÉm tra thay ƒë·ªïi (Smart Save)
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.getElementById('editForm');
        const saveBtn = document.getElementById('saveBtn');
        const msg = document.getElementById('changeMsg');
        
        // L∆∞u gi√° tr·ªã ban ƒë·∫ßu
        const initialData = {
            username: document.getElementById('usernameInput').value,
            grade: document.getElementById('gradeSelect').value,
            password: "" // M·∫≠t kh·∫©u ban ƒë·∫ßu lu√¥n coi l√† r·ªóng
        };

        function checkChanges() {
            const currentData = {
                username: document.getElementById('usernameInput').value,
                grade: document.getElementById('gradeSelect').value,
                password: document.getElementById('passwordInput').value
            };

            // Logic so s√°nh:
            // 1. T√™n ho·∫∑c Kh·ªëi kh√°c ban ƒë·∫ßu
            // 2. HO·∫∂C m·∫≠t kh·∫©u kh√¥ng c√≤n r·ªóng (t·ª©c l√† c√≥ nh·∫≠p pass m·ªõi)
            const isChanged = (
                currentData.username !== initialData.username || 
                currentData.grade !== initialData.grade || 
                currentData.password !== "" 
            );

            if (isChanged) {
                saveBtn.disabled = false;
                saveBtn.classList.remove('opacity-50');
                msg.style.display = 'block';
            } else {
                saveBtn.disabled = true;
                saveBtn.classList.add('opacity-50');
                msg.style.display = 'none';
            }
        }

        form.addEventListener('input', checkChanges);
        form.addEventListener('change', checkChanges);
    });
</script>
{% endblock %}